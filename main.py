import telebot
from telebot import types

from config import *
from photo_file_ids import *

# Import to generate a random session ID
import string
import random

# –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞ –¥–ª—è Telegram
bot = telebot.TeleBot(TELEGRAM_TOKEN)


# –°–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∏–≥—Ä–æ–∫–∞—Ö(–∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç —Å–≤–∞–ø–∞—Ç—å—Å—è)
class Player:
    def __init__(self, player_id: int, username: str, chat_id: int):
        self.player_id = player_id
        self.username = username
        self.chat_id = chat_id


# –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∫–ª–∞—Å—Å–∞ Player
player1 = Player(player_id=0, username="", chat_id=0)
player2 = Player(player_id=0, username="", chat_id=0)


# –ö–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∏–≥—Ä–æ–∫–∞—Ö  –≤–Ω–µ —Å–≤–∞–ø–æ–≤ (–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ—á–∫–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥—ã)
class Gainer:
    def __init__(self, player_id, username: str, score: int, session_id: str):
        self.player_id = player_id
        self.username = username
        self.score = score
        self.session_id = session_id


# –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∫–ª–∞—Å—Å–∞ Gainer
gainer1 = Gainer(player_id=0, username="", score=0, session_id="")
gainer2 = Gainer(player_id=0, username="", score=0, session_id="")

# –•–æ–¥ –∏–≥—Ä—ã
global turn

# Dictionary to store game sessions
sessions = {}


# Function to generate a random session ID
def generate_session_id():
    return ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))


# –ö–æ–º–∞–Ω–¥–∞ /help
@bot.message_handler(commands=['help'])
def help_command(message):
    help_message = (

        "–ö–æ–º–∞–Ω–¥–∞ üí´ DIXIT: –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É üí´ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –≤ DIXIT: 9 lives mod. –ú–æ–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è "
        "–≤–µ—Ä—Å–∏—é "
        "–∏–≥—Ä—ã –¥–ª—è –¥–≤–æ–∏—Ö, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤ –¥–µ–≤—è—Ç—å —Ä–∞—É–Ω–¥–æ–≤ üé≤\n\n"
        "‚ô¶Ô∏è –ü–†–ê–í–ò–õ–ê –ò–ì–†–´ –≤ DIXIT: 9 lives mod: ‚ô¶Ô∏è\n\n"
        "1Ô∏è‚É£ –î–ª—è –∏–≥—Ä—ã –≤ DIXIT: 9 lives mod –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É –∫–Ω–æ–ø–∫–æ–π üí´ DIXIT: –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É üí´ –∏ "
        "–ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä—É –≤–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É"
        " /join\n"
        "2Ô∏è‚É£ –í –∏–≥—Ä–µ –µ—Å—Ç—å –¥–≤–µ —Ä–æ–ª–∏ ‚ô¶Ô∏è –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫ ‚ô¶Ô∏è –∏ ‚ô†Ô∏è –£–≥–∞–¥–∞–π–∫–∞ ‚ô†Ô∏è. –ò–Ω–∏—Ü–∏–∏—Ä—É—é—â–∏–π –∏–≥—Ä–æ–∫ –±—É–¥–µ—Ç –ø–µ—Ä–≤—ã–º Ô∏è "
        "–ó–∞–≥–∞–¥–æ—á–Ω–∏–∫–æ–º, –∞ –µ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä –±—É–¥–µ—Ç –£–≥–∞–¥–∞–π–∫–æ–π. –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –º–µ–Ω—è—Ç—å—Å—è —Ä–æ–ª—è–º–∏ –≤ —Ö–æ–¥–µ –∏–≥—Ä—ã.\n"
        "3Ô∏è‚É£ –í –∫–∞–∂–¥–æ–º —Ö–æ–¥–µ –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫ –±—É–¥–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –∏ –µ–≥–æ –∑–∞–¥–∞—á–µ–π –±—É–¥–µ—Ç –Ω–µ —É–∫–∞–∑—ã–≤–∞—è –Ω–∞ –Ω–µ—ë –ø—Ä—è–º–æ "
        "–æ–±—å—è—Å–Ω–∏—Ç—å –£–≥–∞–¥–∞–π–∫–µ –ø—É—Ç—ë–º –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π –∫–∞–∫—É—é –∫–∞—Ä—Ç–æ—á–∫—É –æ–Ω –∑–∞–≥–∞–¥–∞–ª.\n"
        "4Ô∏è‚É£ –ù–∞–±–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ —É –∏–≥—Ä–æ–∫–æ–≤ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –Ω–æ –£–≥–∞–¥–∞–π–∫–µ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ª—é–±–∞—è –∑–∞–≥–∞–¥—ã–≤–∞–µ–º–∞—è "
        "–∫–∞—Ä—Ç–æ—á–∫–∞.\n"
        "5Ô∏è‚É£ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–∞–±—Ä–∞–Ω–Ω—ã—Ö –æ—á–∫–æ–≤.\n\n"
        "‚ô¶Ô∏è –ü–†–ê–í–ò–õ–ê –ù–ê–ë–û–†–ê –û–ß–ö–û–í: ‚ô¶Ô∏è\n\n"
        "1Ô∏è‚É£ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ö–æ–¥ –≤ —Å–ª—É—á–∞–µ —É–≥–∞–¥—ã–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏–Ω–æ—Å–∏—Ç –æ–¥–Ω–æ –æ—á–∫–æ –£–≥–∞–¥–∞–π–∫–µ, –Ω–∞ –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫–∞ —ç—Ç–æ –Ω–µ "
        "–≤–ª–∏—è–µ—Ç.\n"
        "2Ô∏è‚É£ –ü–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–π –∏–≥—Ä–æ–∫, –≤ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –∏–º–µ–µ—Ç –±–æ–ª—å—à–µ —Ö–æ–¥–æ–≤, –±—ã–ª –≤–≤–µ–¥–µ–Ω —Å—É–ø–µ—Ä—Ö–æ–¥."
        "–í –ø—è—Ç–æ–º —Ö–æ–¥–µ —Å–º–µ–∫–∞–ª–∫–∞ –£–≥–∞–¥–∞–π–∫–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω–µ—Å–µ—Ç –µ–º—É –æ—á–∫–æ, –Ω–æ –∏ –≤—ã—á—Ç–µ—Ç –æ–¥–Ω–æ —É –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫–∞."
        "–í –æ–±—Ä–∞—Ç–Ω–æ–º —Å–ª—É—á–∞–µ, –Ω–µ–≤–µ–∑–µ–Ω–∏–µ, –Ω–∞–ø—Ä–æ—Ç–∏–≤ –ø—Ä–∏–Ω–µ—Å–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ—á–∫–æ –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫—É.\n\n"
        "–ò–≥—Ä–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–∏—à—å –Ω–∞ üöÄ —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è–ø—Ä–µ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤–º–µ—Å—Ç–µ üöÄ –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç ‚ùå–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö "
        "–∫—Ä–∏—Ç–µ—Ä–∏–µ–≤‚ùå, "
        "—Ç–∞–∫ —á—Ç–æ –Ω–µ –ø–µ—á–∞–ª—å—Ç–µ—Å—å –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞.\n\n"
        "–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –≤–≤–µ—Å—Ç–∏ /start \n\n"
        "–ë–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–±–æ –º–Ω–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –ø–æ—Å–µ—Ç–∏–≤ "
        "https://github.com/rumiantsevaa/DIXIT_Telegram_Bot"
    )
    bot.send_message(message.chat.id, help_message)


@bot.message_handler(commands=['start'])
def start_button_handler(message):
    # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    start_message = ("–ó–¥—Ä–∞—Å—Ç–≤—É–π—Ç–µ! –Ø –±–æ—Ç –¥–ª—è –∏–≥—Ä—ã –≤ DIXIT: 9 lives mod. –ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è –º—ã —É–∂–µ –≥–¥–µ-—Ç–æ –≤–∏–¥–µ–ª–∏—Å—åü§î –ù–æ, "
                     "—è —Å–æ–≤—Å–µ–º —ç—Ç–æ–≥–æ –Ω–µ –ø–æ–º–Ω—é. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É,"
                     "–Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üí´ DIXIT: –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É üí´ –∏–ª–∏ —É–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ–±–æ –º–Ω–µ –ø–æ –∫–æ–º–∞–Ω–¥–µ /help.")

    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π "–°—Ç–∞—Ä—Ç"
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    button1 = types.KeyboardButton("DIXIT: –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É")
    markup.add(button1)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    bot.send_message(message.chat.id, start_message, reply_markup=markup)


# –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã, –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–µ–º –∏–≥—Ä–æ–∫–µ
@bot.message_handler(commands=['dixit_match_starter'], chat_types=['private'])
def dixit_match_starter(message):
    bot.send_message(message.chat.id,
                     message.from_user.username + ", –í—ã ‚ô¶Ô∏è –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫ ‚ô¶Ô∏è")

    player1.player_id = message.from_user.id
    player1.username = message.from_user.username
    player1.chat_id = message.chat.id

    # –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–æ–≤ –¥–æ —Å–≤–∞–ø–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ—á–∫–æ–≤
    gainer1.player_id = player1.player_id
    gainer1.username = player1.username

    # Generate a random session ID
    session_id = generate_session_id()
    sessions[session_id] = gainer1
    gainer1.session_id = session_id

    bot.send_message(message.chat.id, "–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –≤–≤–µ—Å—Ç–∏ /join –¥–ª—è "
                                      "–ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ ‚ô†Ô∏è –£–≥–∞–¥–∞–π–∫–∞ ‚ô†Ô∏è\n"
                                      f"–í–∞—à ID —Å–µ—Å—Å–∏–∏: {session_id}.\n–¢–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ "
                                      f"–ø–∞—Ä—Ç–Ω–µ—Ä—É, —á—Ç–æ–±—ã –æ–Ω —Å–º–æ–≥ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è.")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Å–æ–ª–∏.–ß—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–±—ä–µ–∫—Ç–∞ player,–æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –µ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º –Ω–∞–ø—Ä—è–º—É—é.
    print(" –ò–≥—Ä–æ–∫ 1: ", player1.player_id, player1.username, player1.chat_id, gainer1.session_id)
    print(sessions)
    bot.register_next_step_handler(message, handle_join)


# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–≥—Ä—ã
def handle_check():
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–≥—Ä—ã, –µ—Å–ª–∏ –≤—Å—ë –æ–∫, —Ç–æ –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
    if player1.player_id != 0 and player2.player_id != 0 and player1.player_id != player2.player_id:
        return True

    else:
        bot.send_message(player2.chat_id,
                         "–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∏–≥—Ä–∞—Ç—å –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–Ω–∏—Ü–∏–∏—Ä—É–π—Ç–µ –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ –≤–µ—Ä–Ω—É–≤—à–∏—Å—å –≤ –º–µ–Ω—é "
                         "/start"
                         "–∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–ø—Ä–æ—Å–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –≤–≤–µ—Å—Ç–∏ /join –¥–ª—è "
                         "–ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ ‚ô†Ô∏è –£–≥–∞–¥–∞–π–∫–∞ ‚ô†Ô∏è ")


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /join –∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ–± –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–≤—à–µ–º—Å—è –∏–≥—Ä–æ–∫–µ
def handle_join(message: types.Message):
    if message.text.lower() == '/join':
        bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ ID —Å–µ—Å—Å–∏–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è:")


def handle_join_session(message: types.Message):
    session_id = message.text
    if session_id in sessions and gainer1.session_id == session_id:
        bot.send_message(message.chat.id, player1.username + " - –í–∞—à –æ–ø–ø–æ–Ω–µ–Ω—Ç –∏ ‚ô¶Ô∏è –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫ ‚ô¶Ô∏è")
        bot.send_message(message.chat.id, message.from_user.username + " - –í—ã ‚ô†Ô∏è –£–≥–∞–¥–∞–π–∫–∞ ‚ô†Ô∏è ")
        bot.send_message(player1.chat_id, message.from_user.username + " - –ø–æ–ª—É—á–∏–ª —Å—Ç–∞—Ç—É—Å ‚ô†Ô∏è –£–≥–∞–¥–∞–π–∫–∞ ‚ô†Ô∏è ")

        player2.player_id = message.from_user.id
        player2.username = message.from_user.username
        player2.chat_id = message.chat.id

        # –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–æ–≤ –¥–æ —Å–≤–∞–ø–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ—á–∫–æ–≤
        gainer2.player_id = player2.player_id
        gainer2.username = player2.username

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Å–æ–ª–∏
        print(" –ò–≥—Ä–æ–∫ 2: ", player2.player_id, player2.username, player2.chat_id, gainer2.session_id)
        if handle_check():
            handle_array_of_ids()
    else:
        bot.send_message(message.chat.id, "–ù–µ–≤–µ—Ä–Ω—ã–π ID —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –∏–≥—Ä–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞—Å—å.")
        dixit_match_starter()


# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Å—Å–∏–≤–∞ –∏–∑ –∞–π–¥–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¢–ì —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
def handle_array_of_ids():
    # –°–æ–∑–¥–∞—ë–º –º–∞—Å—Å–∏–≤ –∞–π–¥–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π, –¥–µ–≤—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    array_of_ids = []
    for i in range(9):
        random_photo_id = random.choice(photo_file_ids)
        array_of_ids.append(random_photo_id)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ –∞–π–¥–∏ –¥–ª—è –£–≥–∞–¥–∞–π–∫–∏ —Å –∫-–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ : 9
    bot.send_media_group(player2.chat_id, [types.InputMediaPhoto(media) for media in array_of_ids])

    # –ú–∞—Å—Å–∏–≤ —Ç–µ—Ä—è–µ—Ç —Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞,  –º–µ—à–∞–µ—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫—É
    # –ê–Ω—Ç–∏—Ö–∏—Ç—Ä–∏–Ω –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –ø–æ—Ä—è–¥–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    random.shuffle(array_of_ids)
    del array_of_ids[6:9]
    random.shuffle(array_of_ids)
    bot.send_media_group(player1.chat_id, [types.InputMediaPhoto(media) for media in array_of_ids])

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç "–í—ã–±–∏—Ä–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É, –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç–µ –æ–ø–ø–æ–Ω–µ–Ω—Ç—É –∫–∞–∫—É—é –≤—ã –≤—ã–±—Ä–∞–ª–∏."
    bot.send_message(player1.chat_id, player1.username + ", –≤—ã–±–∏—Ä–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É, –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç–µ –æ–ø–ø–æ–Ω–µ–Ω—Ç—É "
                                                         "–∫–∞–∫—É—é –≤—ã"
                                                         "–≤—ã–±—Ä–∞–ª–∏.")
    bot.send_message(player2.chat_id, player2.username + " , –≥–æ—Ç–æ–≤—å—Ç–µ—Å—å —Å–ª—É—à–∞—Ç—å –æ–±—å—è—Å–Ω–µ–Ω–∏—è "
                                                         "‚ô¶Ô∏è –ó–∞–≥–∞–¥–æ—á–Ω–∏–∫–∞ ‚ô¶Ô∏è")

    markupprep = types.InlineKeyboardMarkup()
    buttonprep = types.InlineKeyboardButton(text="–¥–∞", callback_data="yes", one_time_keyboard=True)
    markupprep.add(buttonprep)
    message = bot.send_message(player1.chat_id, player1.username + " , –≥–æ—Ç–æ–≤—ã üëÄ?", reply_markup=markupprep)

    bot.register_next_step_handler(message, handle_answer)


# –í—ã–±–æ—Ä —É–≥–∞–¥–∞–ª –ª–∏ –∏–≥—Ä–æ–∫ –∏ –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏–µ –ø–æ–±–µ–¥—ã
def handle_answer(message):
    bot.send_message(message.chat.id, "–û–±—å—è—Å–Ω–∏—Ç–µ ‚ô†Ô∏è –£–≥–∞–¥–∞–π–∫–µ ‚ô†Ô∏è  –∫–∞–∫–∞—è –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—è —É –≤–∞—Å —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π.")
    markup34 = types.InlineKeyboardMarkup()
    button3 = types.InlineKeyboardButton(text="–£–≥–∞–¥–∞–ª ‚òëÔ∏è", callback_data="true", one_time_keyboard=True)
    button4 = types.InlineKeyboardButton(text="–ù–µ —É–≥–∞–¥–∞–ª üé≤", callback_data="false", one_time_keyboard=True)
    markup34.add(button3, button4)

    bot.send_message(player1.chat_id, player1.username + " , —É–≥–∞–¥–∞–ª –ª–∏ ‚ô†Ô∏è –£–≥–∞–¥–∞–π–∫–∞ ‚ô†Ô∏è  –≤–∞—à—É –∫–∞—Ä—Ç–æ—á–∫—É?",
                     reply_markup=markup34)


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è inline –∫–Ω–æ–ø–æ–∫
@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    if call.data == "yes":
        handle_answer(call.message)

    global turn

    if call.data == "true":
        bot.send_message(player2.chat_id, player2.username + " , –≤—ã —É–≥–∞–¥–∞–ª–∏.")
        bot.send_message(player1.chat_id, player1.username + " , –≤—ã–±–æ—Ä –ø—Ä–∏–Ω—è—Ç.")
        try:
            turn, gainer1.score, gainer2.score
        except NameError:
            turn, gainer1.score, gainer2.score = 1, 0, 0

        # –ï—Å–ª–∏ —Ö–æ–¥ –Ω–µ—á–µ—Ç–Ω—ã–π, —Ç–æ Gainer 2 –ø–æ–ª—É—á–∞–µ—Ç –æ—á–∫–æ
        if turn % 2 != 0:
            gainer2.score += 1
            print("Gainer 2 –ø–æ–ª—É—á–∞–µ—Ç +1")
        elif turn == 5:
            gainer2.score += 1
            gainer1.score -= 1
        # –ï—Å–ª–∏ —Ö–æ–¥ —á–µ—Ç–Ω—ã–π, —Ç–æ Gainer 1 –ø–æ–ª—É—á–∞–µ—Ç –æ—á–∫–æ
        else:
            gainer1.score += 1
            print("Gainer 1 –ø–æ–ª—É—á–∞–µ—Ç +1")
        print("–•–û–î:", turn, "–°–ß–ï–¢ Gainer 1:", gainer1.score, "–°–ß–ï–¢ Gainer 2:", gainer2.score)
        turn += 1
        handle_continue()

    if call.data == "false":
        bot.send_message(player2.chat_id, player2.username + " , –≤—ã –Ω–µ —É–≥–∞–¥–∞–ª–∏")
        bot.send_message(player1.chat_id, player1.username + " , –≤—ã–±–æ—Ä –ø—Ä–∏–Ω—è—Ç.")
        try:
            turn, gainer1.score, gainer2.score
        except NameError:
            turn, gainer1.score, gainer2.score = 0, 0, 0
        if turn == 5:
            gainer2.score -= 1
            gainer1.score += 1
        else:
            gainer1.score += 0
            gainer2.score += 0
            turn += 1

        print("–•–û–î:", turn, "–°–ß–ï–¢ –ì–µ–π–º–µ—Ä 1:", gainer1.score, "–°–ß–ï–¢ –ì–µ–π–º–µ—Ä 2:", gainer2.score)
        handle_continue()


def handle_continue():
    if turn == 9:
        winner = gainer1.score > gainer2.score
        if winner:
            bot.send_message(player1.chat_id, "üî•üî•" + gainer1.username + "üî•üî• - –í—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—å")
            bot.send_message(player2.chat_id, "üëæ" + gainer2.username + "üëæ - –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏")
        elif gainer1.score == gainer2.score:
            bot.send_message(player1.chat_id, "ü§î –ù–ò–ß–¨–Ø ü§î")
            bot.send_message(player2.chat_id, "ü§î –ù–ò–ß–¨–Ø ü§î")
        else:
            bot.send_message(player1.chat_id, "üî•üî•" + gainer2.username + "üî•üî• - –í—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—å")
            bot.send_message(player2.chat_id, "üëæ" + gainer1.username + "üëæ - –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏")

        bot.send_message(player1.chat_id, "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞")
        bot.send_message(player2.chat_id, "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞")
    else:
        bot.send_message(player1.chat_id, "–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å –æ—Ç–≥–∞–¥—ã–≤–∞—Ç—å!")  # –≠—Ç–æ –ø–µ—Ä–≤–æ–º—É –∏–≥—Ä–æ–∫—É

        bot.send_message(player2.chat_id, player2.username + " , –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å –∑–∞–≥–∞–¥—ã–≤–∞—Ç—å!")  # –≠—Ç–æ  –∏–≥—Ä–æ–∫—É2
        # –°–≤–∞–ø –∏–≥—Ä–æ–∫–æ–≤ –º–µ—Å—Ç–∞–º–∏
        player1.player_id, player2.player_id = player2.player_id, player1.player_id
        player1.chat_id, player2.chat_id = player2.chat_id, player1.chat_id
        player1.username, player2.username = player2.username, player1.username
        handle_array_of_ids()


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª—é–±—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: True, content_types=['text'])
def handle_text(message):
    if message.text.lower() == 'dixit: –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É':
        dixit_match_starter(message)
    elif message.text.lower() == '/join':
        handle_join(message)
    elif message.text.upper() in sessions:
        print("yes it fckng worked")
        handle_join_session(message)
    elif message.text.lower() == '–¥–∞':
        handle_answer(message)
    elif message.text.lower() == '–ø—Ä–∏–≤–µ—Ç':
        bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –Ω–∞–∂–º–∏—Ç–µ /start")
    else:
        bot.send_message(message.chat.id, "–Ø –≤–∞—Å –Ω–µ –ø–æ–Ω–∏–º–∞—é. –ù–∞–∂–º–∏—Ç–µ /start –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.")


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == '__main__':
    bot.polling(none_stop=True, interval=0)
